#!/bin/bash
# ==========================================================
# CML TRUECOLOR ENGINE SANITY TEST
# Version: 1.0.0
# Path: ~/kh-scripts/library/colors/cml-truecolor-sanity.sh
# Purpose: Verify core RGB + reset + detection functions
# ==========================================================

ENGINE="$HOME/kh-scripts/library/colors/cml-truecolor.sh"
if [ ! -f "$ENGINE" ]; then
  echo "‚ùå ENGINE NOT FOUND: $ENGINE"
  exit 1
fi

source "$ENGINE"

echo
echo "=== üß™ CML TRUECOLOR ENGINE ‚Äî SANITY TEST ==="
echo "ENGINE VERSION: $CML_TRUECOLOR_VERSION"
echo "---------------------------------------------"

# Test 1 ‚Äî TRUECOLOR Detection
if [ "$(cml_truecolor_supported)" -eq 1 ]; then
  echo "üéØ TRUECOLOR DETECTED ‚Äî OK"
else
  echo "‚ö† FALLBACK MODE ‚Äî TRUECOLOR NOT SUPPORTED"
fi

# Test 2 ‚Äî RGB Foreground & Background Safety
echo
echo "‚Üí TESTING SAFE RGB FORMATTING"
printf "FG: %sTEST%s\n" "$(rgb_fg 255 80 0)" "$(cml_reset)"
printf "BG: %sTEST%s\n" "$(rgb_bg 0 120 255)" "$(cml_reset)"
printf "FG SAFE (BAD INPUTS): %sTEST%s\n" "$(rgb_fg a b c)" "$(cml_reset)"
printf "BG SAFE (BAD INPUTS): %sTEST%s\n" "$(rgb_bg '' '' '')" "$(cml_reset)"

# Test 3 ‚Äî HEX Conversion
echo
echo "‚Üí HEX ‚Üí RGB CONVERSION"
for h in "#FF6600" "#33CCFF" "#7F7FFF"; do
  read -r r g b <<<"$(hex_to_rgb "$h")"
  echo "$h  ‚Üí  $r $g $b"
done

# Test 4 ‚Äî Gradient Sample
echo
echo "‚Üí GRADIENT DEMO (5 STEPS: ORANGE ‚Üí BLUE)"
cml_make_gradient "#FF6600" "#33CCFF" 5
echo

# Test 5 ‚Äî Reset Validation
echo
echo "‚Üí RESET CHECK"
printf "%sTEXT BEFORE RESET%s TEXT AFTER RESET\n" "$(rgb_fg 255 0 255)" "$(cml_reset)"

echo
echo "‚úî SANITY TEST COMPLETE."
echo
