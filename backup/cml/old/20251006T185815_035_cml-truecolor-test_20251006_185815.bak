#!/usr/bin/env bash
# ============================================================
# File: ~/kh-scripts/library/colors/cml-truecolor-test.sh
# COLOR MASTER TRUECOLOR ENGINE SELF-TEST (v1.4.0)
# ============================================================

ENGINE_VERSION="v1.4.0"
CML_DIR="$HOME/kh-scripts/library/colors"
THEME_FILE="$CML_DIR/.cml_theme"

# ============================================================
# THEME READ STANDARD
# ============================================================
if [ -f "$THEME_FILE" ]; then
  CURRENT_THEME=$(< "$THEME_FILE")
  CURRENT_THEME="${CURRENT_THEME//[$'\r\n']/}"
  CURRENT_THEME="${CURRENT_THEME^^}"
else
  CURRENT_THEME=""
fi

# ============================================================
# AUTO-DEFAULT THEME
# ============================================================
if [ -z "$CURRENT_THEME" ]; then
  CURRENT_THEME="CLASSIC"
  printf "%s" "$CURRENT_THEME" > "$THEME_FILE"
  sync
fi

# ============================================================
# LOAD TRUECOLOR ENGINE
# ============================================================
if [ -f "$CML_DIR/cml-truecolor.sh" ]; then
  source "$CML_DIR/cml-truecolor.sh"
  echo "‚úî COLOR MASTER TRUECOLOR ENGINE LOADED ($CML_TRUECOLOR_VERSION)"
else
  echo "‚ùå TRUECOLOR ENGINE NOT FOUND AT $CML_DIR/cml-truecolor.sh"
  exit 1
fi

# ============================================================
# SELF-TEST HEADER
# ============================================================
echo
printf "üåà TRUECOLOR ENGINE SELF-TEST\n"
printf "ENGINE VERSION: %s\n" "$ENGINE_VERSION"
printf "CURRENT ACTIVE THEME: %s\n" "$CURRENT_THEME"
echo

# ============================================================
# TEST FUNCTION
# ============================================================
test_theme() {
  local theme="$1"
  echo
  echo "‚îÄ‚îÄ‚îÄ TESTING THEME: $theme ‚îÄ‚îÄ‚îÄ"
  echo

  cml_load_palette "$theme"
  cml_render_gradient_bar
  cml_apply_theme_gradient "THE QUICK BROWN FOX JUMPS OVER THE LAZY DOG"
}

# ============================================================
# RUN TESTS FOR ALL THEMES
# ============================================================
themes=(
  "CLASSIC"
  "FOREST"
  "DESERT"
  "OCEAN"
  "SUMMER"
  "WINTER"
  "WILD"
  "NEON:RED"
  "NEON:ORANGE"
  "NEON:BLUE"
  "NEON:PURPLE"
)

for theme in "${themes[@]}"; do
  test_theme "$theme"
done

# ============================================================
# COMPLETION MESSAGE
# ============================================================
echo
echo "‚úî ALL TESTS PASSED IF COLORS AND GRADIENTS DISPLAY CORRECTLY."
echo
