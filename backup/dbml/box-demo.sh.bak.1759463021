#!/usr/bin/env bash
# DBML Demo â€” v4.1.0
DBML_LIB_DIR="${HOME}/kh-scripts/library/dynamic_box"
CSML_PATH="${HOME}/kh-scripts/library/characters_symbols/csml_template.sh"
CML_PATH="${HOME}/kh-scripts/library/color_master/cml_template.sh"

source "$DBML_LIB_DIR/dbml_template.sh"

# Try CSML and CML
dbml_use_csml "$CSML_PATH" || true
dbml_use_cml "$CML_PATH" || true

CONTENT="This is DBML v4.1.0 demo.
CSML symbols (if installed) are tofu-safe.
Fallback = old built-in symbols."

clear
draw_box single 62 1 "Single-line (CSML if available)" "$CONTENT"
echo
draw_box double 62 1 "Double-line (CSML if available)" "$CONTENT"
echo
draw_box rounded 62 1 "Rounded (CSML if available)" "$CONTENT"

echo
printf "Pulse demo (CML if available):\n"
if declare -p CML_COLOR_1 >/dev/null 2>&1; then
  dbml_pulse CML_COLOR 0.08 10
else
  dbml_pulse UNKNOWN 0.08 10
fi

echo
printf "\nCheatsheet:\n"
cat <<'EOF'
draw_box <style> <width> <pad> "title" "content"
  styles: single|double|rounded

dbml_pulse <prefix> <delay> <iterations>
dbml_use_cml <path-to-cml>
dbml_use_csml <path-to-csml>
EOF

mkdir -p "${HOME}/kh-scripts/logs"
printf "%s - ran dbml v4.1.0 demo\n" "$(date -u '+%Y-%m-%dT%H:%M:%SZ')" >> "${HOME}/kh-scripts/logs/dbml-demo.log"
