# robust section: read theme, try to load palette, and print exactly one ACTIVE THEME line
# (keeps braces and if/fi balanced; uses theme_accent_print to follow active palette)
if [ -f "$THEME_FILE" ]; then
  CURRENT_THEME=$(awk 'NF{print; exit}' "$THEME_FILE" 2>/dev/null || printf 'CLASSIC')
  CURRENT_THEME=$(printf '%s' "$CURRENT_THEME" | tr -d '\r\n')
  CURRENT_THEME="${CURRENT_THEME^^}"
else
  CURRENT_THEME="CLASSIC"
  printf "%s" "$CURRENT_THEME" > "$THEME_FILE"
fi

PALETTE_OK=false
if declare -F cml_load_palette >/dev/null 2>&1 && cml_load_palette "$CURRENT_THEME" >/dev/null 2>&1; then
  PALETTE_OK=true
fi

# Print a single ACTIVE THEME line using the theme accent fallback order.
theme_accent_print "âœ” ACTIVE THEME: ${CURRENT_THEME}"
# single blank line after section
printf "\n"
